<!- PRO --------------------------------------------------------------------------------------- PRO - PRO -- File name:   Z:\rockdb\output\XE12aldebarancenturytelecomnetbr/job_ddl_XE12.html
- PRO -- Purpose:     Jobs scripts
- PRO -- Warning:
- PRO -- Author:      Andre Rocha
- PRO -- Version:     13/04/2021 12:18
- PRO -- Usage:
- PRO -- Example:
- PRO -- Notes:       Developed and tested on 11.2.0.3
- PRO -------------------------------------------------------------------------------------- PRO -- @rockdb/sql/headerdoc.sql name.html "Created to output list of html report" "Pay attention to variables" "Usage" "example usage"
-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<!-- $Header:  $ -->
<!-- rock_copyright (c) 2021, All rights reserved. -->
<!-- Author: techmaxconsultoria@gmail.com -->
<head>
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
<link rel="icon" href="icon/server.svg" type="image/x-icon" />
<title>Jobs scripts</title>
<style type="text/css">
body             {font:10pt Arial,Helvetica,Geneva,sans-serif; color:black; background:white;}
h1               {font-size:16pt; font-weight:bold; color:#336699; border-bottom:5px solid #336699; margin-top:0pt; margin-bottom:0pt; padding:0px 0px 0px 0px;}
h2               {font-size:14pt; font-weight:bold; color:#336699; margin-top:4pt; margin-bottom:0pt;}
h3               {font-size:12pt; font-weight:bold; color:#336699; margin-top:4pt; margin-bottom:0pt;}
pre              {font:8pt monospace,Monaco,"Courier New",Courier;}
a                {color:#663300;}
table            {font-size:8pt; border-collapse:collapse; empty-cells:show; white-space:nowrap; border:1px solid #336699;}
li               {font-size:8pt; color:black; padding-left:4px; padding-right:4px; padding-bottom:2px;}
th               {font-weight:bold; color:red; background:#0066CC; padding-left:4px; padding-right:4px; padding-bottom:2px;}
tr               {color:black; background:white;}
tr:hover         {color:white; background:#0066CC;}
tr.main          {color:black; background:white;}
tr.main:hover    {color:black; background:white;}
td               {vertical-align:top; border:1px solid #336699;}
td.c             {text-align:center;}
font.n           {font-size:8pt; font-style:italic; color:#336699;}
font.f           {font-size:8pt; color:#999999; border-top:1px solid #336699; margin-top:30pt;}
div.google-chart {width:809px; height:500px;}
</style>
</head>

<h1> <a href="index_XE12.html" target="_blank"><img src="icon/server.svg" alt="index_XE12.html" height="33" width="52" /></a> XE12.html <em>(Jobs scripts)</em>  </h1>
<PRE>

+------------------------------------------------------------------------------+
|            Jobs for this database DBA_SCHEDULER_JOBS   non SYS               |
+------------------------------------------------------------------------------+

ERROR:
ORA-31603: object "MGMT_CONFIG_JOB" of type PROCOBJ not found in schema "ORACLE_OCM"
ORA-06512: at "SYS.DBMS_METADATA", line 6478
ORA-06512: at "SYS.DBMS_SYS_ERROR", line 105
ORA-06512: at "SYS.DBMS_METADATA", line 6465
ORA-06512: at "SYS.DBMS_METADATA", line 9202
ORA-06512: at line 1


exec dbms_job.isubmit(job=>183,what=>'DECLARE
 CURSOR C1 IS
    SELECT CTR.NUMCONTRATO AS CONTRATO,
       TO_CHAR (ADD_MONTHS (SYSDATE, -1), 'YYYY-MM') || '-01' AS DTINI,
       TO_CHAR (LAST_DAY (ADD_MONTHS (SYSDATE, -1)), 'YYYY-MM-DD') AS DTFIM,
       CTR.CODPARC AS CODPARC
  FROM TCSCON CTR, TCSPSC PRE
 WHERE     CTR.NUMCONTRATO = PRE.NUMCONTRATO
       AND CTR.ATIVO = 'S'
       AND PRE.CODPROD = 1106
       AND NOT EXISTS
              (SELECT 1
                 FROM TCSOCC X
                WHERE CODOCOR IN (2, 4)
                      AND X.NUMCONTRATO = CTR.NUMCONTRATO
                      AND DTOCOR = (SELECT MAX (DTOCOR)
                                      FROM TCSOCC XC
                                     WHERE XC.NUMCONTRATO = X.NUMCONTRATO))
       AND CTR.DTREFPROXFAT < TRUNC (LAST_DAY (ADD_MONTHS (SYSDATE, -1)) + 1)
       AND CTR.DTREFPROXFAT =
              TO_DATE (
                 '01/' || TO_CHAR (ADD_MONTHS (SYSDATE, -1), 'MM/YYYY'),
                 'DD/MM/YYYY');
BEGIN

FOR R1 IN C1
LOOP

--dbms_output.put_line(R1.CONTRATO||'/'||R1.DTINI||'/'||R1.DTFIM||'/'||R1.CODPARC);
 PRG_TIPTOSNK_CENTURY(R1.CONTRATO, R1.DTINI, R1.DTFIM, R1.CODPARC);

END LOOP;

END;',next_date=>'01/05/2021 08:30',interval=>'TRUNC(LAST_DAY(SYSDATE)) + 1 + 8/24 + 30/1440',no_parse=>TRUE);
exec dbms_job.isubmit(job=>221,what=>'DECLARE
CURSOR C1 IS
 SELECT  * FROM TCSPRE WHERE CODPROD = 1106 AND AD_VLRFRANQUIA < VALOR;

BEGIN
    FOR R1 IN C1
    LOOP
        UPDATE TCSPRE SET VALOR = R1.AD_VLRFRANQUIA WHERE NUMCONTRATO = R1.NUMCONTRATO AND REFERENCIA = R1.REFERENCIA AND CODPROD = 1106;
    END LOOP;
END;',next_date=>'30/04/2021 00:30',interval=>'TRUNC(LAST_DAY(SYSDATE))+ 30/1440',no_parse=>TRUE);
exec dbms_job.isubmit(job=>241,what=>'CTRY_ALT_DTREAJUSTE_CONTRATO;
',next_date=>'01/05/2021 00:00',interval=>'TRUNC(LAST_DAY(SYSDATE)) + 1',no_parse=>TRUE);
exec dbms_job.isubmit(job=>242,what=>'VOLTA_DATAREAJUTE_CONTRATO;
 ',next_date=>'19/04/2021 00:00',interval=>'TRUNC(SYSDATE+30)',no_parse=>TRUE);
exec dbms_job.isubmit(job=>261,what=>'DECLARE
 CURSOR C1 IS
 SELECT P.RAZAOSOCIAL,  LISTAGG(CASE WHEN F.CODTIPOPER = 1802 THEN F.NUMNFSE ELSE TO_CHAR(F.NUMNOTA) END,' / ') WITHIN GROUP (ORDER BY CASE WHEN F.CODTIPOPER = 1802 THEN F.NUMNFSE ELSE TO_CHAR(F.NUMNOTA) END) AS NOTAS,
     to_char(sum(F.VLRDESDOB), '99G999G999D09')  AS VALOR, F.DTVENC
    FROM TGFFIN F, TGFPAR P
    WHERE F.DTVENC+15 = TRUNC(SYSDATE)
  AND F.CODPARC = P.CODPARC
  AND F.RECDESP = 1
  AND F.PROVISAO = 'N'
  AND F.DHBAIXA IS NULL
  GROUP BY P.RAZAOSOCIAL,  F.DTVENC;

  p_mensagem         CLOB;
  p_msgloop          CLOB;


BEGIN


FOR R1 IN C1

LOOP
  p_msgloop :=  p_msgloop||  '<tr><td>'||R1.RAZAOSOCIAL||'</td>
                                  <td>'||TO_CHAR(R1.DTVENC,'DD/MM/YYYY')||'</td>
                                  <td  style="text-align: left;">'||R1.NOTAS||'</td>
                                  <td  style="text-align: right">'||R1.VALOR||'</td></tr>';
END LOOP;
p_mensagem    := '<!DOCTYPE html>
                                            <html lang="pt-br">
                                            <head>
                                              <style>
                                                table, th, td {
                                                    border: 1px solid black;
                                                    border-collapse: collapse;
                                                    text-align: center;
                                                    font-size: 10px;
                                                    padding-left: 2px;
                                                    padding-right: 2px;
                                                }
                                               </style>
                                              <title>Clientes em aberto a 15 dias ou mais</title>
                                            </head>
                                            <body>
                                               <h3>Clientes em aberto a 15 dias ou mais</h3>
                                                <table>
                                                    <tr>
                                                        <th>Raz達o Social</th>
                                                        <th>Em aberto desde</th>
                                                        <th>Notas Emitidas</th>
                                                        <th>Debito Total</th>
                                                    </tr>'
                                                    ||p_msgloop||
                                                    '
                                                </table>
                                            </body>
                                          </html>';

send_mail(p_to        => 'cobranca@century.net.br',
           p_from      => 'erp@centurytelecom.com.br',
           p_cc        => 'philipe@century.net.br',
           p_subject   => 'Clientes em aberto a 15 dias ou mais',
           p_text_msg  => '',
           p_html_msg  =>  p_mensagem,
           p_smtp_host => 'maladireta.task.com.br');

END;',next_date=>'01/01/4000 00:00',interval=>'TRUNC(SYSDATE+1)',no_parse=>TRUE);
exec dbms_job.isubmit(job=>262,what=>'DECLARE
 CURSOR C1 IS
 SELECT P.RAZAOSOCIAL,  LISTAGG(CASE WHEN F.CODTIPOPER = 1802 THEN F.NUMNFSE ELSE TO_CHAR(F.NUMNOTA) END,' / ') WITHIN GROUP (ORDER BY CASE WHEN F.CODTIPOPER = 1802 THEN F.NUMNFSE ELSE TO_CHAR(F.NUMNOTA) END) AS NOTAS,
     to_char(sum(F.VLRDESDOB), '99G999G999D09')  AS VALOR, F.DTVENC
    FROM TGFFIN F, TGFPAR P
    WHERE F.DTVENC+30 = TRUNC(SYSDATE)
  AND F.CODPARC = P.CODPARC
  AND F.RECDESP = 1
  AND F.PROVISAO = 'N'
  AND F.DHBAIXA IS NULL
  GROUP BY P.RAZAOSOCIAL,  F.DTVENC;

  p_mensagem         CLOB;
  p_msgloop          CLOB;


BEGIN


FOR R1 IN C1

LOOP
  p_msgloop :=  p_msgloop||  '<tr><td>'||R1.RAZAOSOCIAL||'</td>
                                  <td>'||TO_CHAR(R1.DTVENC,'DD/MM/YYYY')||'</td>
                                  <td  style="text-align: left;">'||R1.NOTAS||'</td>
                                  <td  style="text-align: right">'||R1.VALOR||'</td></tr>';
END LOOP;
p_mensagem    := '<!DOCTYPE html>
                                            <html lang="pt-br">
                                            <head>
                                              <style>
                                                table, th, td {
                                                    border: 1px solid black;
                                                    border-collapse: collapse;
                                                    text-align: center;
                                                    font-size: 10px;
                                                    padding-left: 2px;
                                                    padding-right: 2px;
                                                }
                                               </style>
                                              <title>Clientes em aberto a 30 dias ou mais</title>
                                            </head>
                                            <body>
                                               <h3>Clientes em aberto a 30 dias ou mais</h3>
                                                <table>
                                                    <tr>
                                                        <th>Raz達o Social</th>
                                                        <th>Em aberto desde</th>
                                                        <th>Notas Emitidas</th>
                                                        <th>Debito Total</th>
                                                    </tr>'
                                                    ||p_msgloop||
                                                    '
                                                </table>
                                            </body>
                                          </html>';

send_mail(p_to        => 'andre.goncalves@century.net.br',
           p_from      => 'erp@centurytelecom.com.br',
           p_cc        => 'philipe@century.net.br',
           p_subject   => 'Clientes em aberto a 30 dias ou mais',
           p_text_msg  => '',
           p_html_msg  =>  p_mensagem,
           p_smtp_host => 'maladireta.task.com.br');

END;',next_date=>'01/01/4000 00:00',interval=>'TRUNC(SYSDATE+1)',no_parse=>TRUE);
exec dbms_job.isubmit(job=>383,what=>'SANKHYA.CHECK_FECHAMENTO_PEND_CTRY;',next_date=>'01/01/4000 00:00',interval=>'TRUNC(SYSDATE+1)+6/24',no_parse=>TRUE);

+------------------------------------------------------------------------------+
|            Jobs for this database DBA_SCHEDULER_JOBS  in SYS                 |
+------------------------------------------------------------------------------+

for Jobs in SYS we need create a user and copy the job to the new schema.

exec dbms_scheduler.copy_job('sys.kill_hung_session','oracle.kill_hung_session_copy')
dbms_scheduler.copy_job('PURGE_LOG','NEWSCHEMA.PURGE_LOG');
dbms_scheduler.copy_job('FILE_WATCHER','NEWSCHEMA.FILE_WATCHER');
dbms_scheduler.copy_job('PMO_DEFERRED_GIDX_MAINT_JOB','NEWSCHEMA.PMO_DEFERRED_GIDX_MAINT_JOB');
dbms_scheduler.copy_job('CLEANUP_NON_EXIST_OBJ','NEWSCHEMA.CLEANUP_NON_EXIST_OBJ');
dbms_scheduler.copy_job('CLEANUP_ONLINE_IND_BUILD','NEWSCHEMA.CLEANUP_ONLINE_IND_BUILD');
dbms_scheduler.copy_job('CLEANUP_TAB_IOT_PMO','NEWSCHEMA.CLEANUP_TAB_IOT_PMO');
dbms_scheduler.copy_job('CLEANUP_TRANSIENT_TYPE','NEWSCHEMA.CLEANUP_TRANSIENT_TYPE');
dbms_scheduler.copy_job('CLEANUP_TRANSIENT_PKG','NEWSCHEMA.CLEANUP_TRANSIENT_PKG');
dbms_scheduler.copy_job('CLEANUP_ONLINE_PMO','NEWSCHEMA.CLEANUP_ONLINE_PMO');
dbms_scheduler.copy_job('FILE_SIZE_UPD','NEWSCHEMA.FILE_SIZE_UPD');
dbms_scheduler.copy_job('ORA$AUTOTASK_CLEAN','NEWSCHEMA.ORA$AUTOTASK_CLEAN');
dbms_scheduler.copy_job('HM_CREATE_OFFLINE_DICTIONARY','NEWSCHEMA.HM_CREATE_OFFLINE_DICTIONARY');
dbms_scheduler.copy_job('DRA_REEVALUATE_OPEN_FAILURES','NEWSCHEMA.DRA_REEVALUATE_OPEN_FAILURES');
dbms_scheduler.copy_job('ORA$PREPLUGIN_BACKUP_JOB','NEWSCHEMA.ORA$PREPLUGIN_BACKUP_JOB');
dbms_scheduler.copy_job('BSLN_MAINTAIN_STATS_JOB','NEWSCHEMA.BSLN_MAINTAIN_STATS_JOB');
dbms_scheduler.copy_job('FGR$AUTOPURGE_JOB','NEWSCHEMA.FGR$AUTOPURGE_JOB');
dbms_scheduler.copy_job('RSE$CLEAN_RECOVERABLE_SCRIPT','NEWSCHEMA.RSE$CLEAN_RECOVERABLE_SCRIPT');
dbms_scheduler.copy_job('SM$CLEAN_AUTO_SPLIT_MERGE','NEWSCHEMA.SM$CLEAN_AUTO_SPLIT_MERGE');
dbms_scheduler.copy_job('LOAD_OPATCH_INVENTORY','NEWSCHEMA.LOAD_OPATCH_INVENTORY');
dbms_scheduler.copy_job('XMLDB_NFS_CLEANUP_JOB','NEWSCHEMA.XMLDB_NFS_CLEANUP_JOB');
exec dbms_job.isubmit(job=>183,what=>'DECLARE
 CURSOR C1 IS
    SELECT CTR.NUMCONTRATO AS CONTRATO,
       TO_CHAR (ADD_MONTHS (SYSDATE, -1), 'YYYY-MM') || '-01' AS DTINI,
       TO_CHAR (LAST_DAY (ADD_MONTHS (SYSDATE, -1)), 'YYYY-MM-DD') AS DTFIM,
       CTR.CODPARC AS CODPARC
  FROM TCSCON CTR, TCSPSC PRE
 WHERE     CTR.NUMCONTRATO = PRE.NUMCONTRATO
       AND CTR.ATIVO = 'S'
       AND PRE.CODPROD = 1106
       AND NOT EXISTS
              (SELECT 1
                 FROM TCSOCC X
                WHERE CODOCOR IN (2, 4)
                      AND X.NUMCONTRATO = CTR.NUMCONTRATO
                      AND DTOCOR = (SELECT MAX (DTOCOR)
                                      FROM TCSOCC XC
                                     WHERE XC.NUMCONTRATO = X.NUMCONTRATO))
       AND CTR.DTREFPROXFAT < TRUNC (LAST_DAY (ADD_MONTHS (SYSDATE, -1)) + 1)
       AND CTR.DTREFPROXFAT =
              TO_DATE (
                 '01/' || TO_CHAR (ADD_MONTHS (SYSDATE, -1), 'MM/YYYY'),
                 'DD/MM/YYYY');
BEGIN

FOR R1 IN C1
LOOP

--dbms_output.put_line(R1.CONTRATO||'/'||R1.DTINI||'/'||R1.DTFIM||'/'||R1.CODPARC);
 PRG_TIPTOSNK_CENTURY(R1.CONTRATO, R1.DTINI, R1.DTFIM, R1.CODPARC);

END LOOP;

END;',next_date=>'01/05/2021 08:30',interval=>'TRUNC(LAST_DAY(SYSDATE)) + 1 + 8/24 + 30/1440',no_parse=>TRUE);
exec dbms_job.isubmit(job=>221,what=>'DECLARE
CURSOR C1 IS
 SELECT  * FROM TCSPRE WHERE CODPROD = 1106 AND AD_VLRFRANQUIA < VALOR;

BEGIN
    FOR R1 IN C1
    LOOP
        UPDATE TCSPRE SET VALOR = R1.AD_VLRFRANQUIA WHERE NUMCONTRATO = R1.NUMCONTRATO AND REFERENCIA = R1.REFERENCIA AND CODPROD = 1106;
    END LOOP;
END;',next_date=>'30/04/2021 00:30',interval=>'TRUNC(LAST_DAY(SYSDATE))+ 30/1440',no_parse=>TRUE);
exec dbms_job.isubmit(job=>241,what=>'CTRY_ALT_DTREAJUSTE_CONTRATO;
',next_date=>'01/05/2021 00:00',interval=>'TRUNC(LAST_DAY(SYSDATE)) + 1',no_parse=>TRUE);
exec dbms_job.isubmit(job=>242,what=>'VOLTA_DATAREAJUTE_CONTRATO;
 ',next_date=>'19/04/2021 00:00',interval=>'TRUNC(SYSDATE+30)',no_parse=>TRUE);
exec dbms_job.isubmit(job=>261,what=>'DECLARE
 CURSOR C1 IS
 SELECT P.RAZAOSOCIAL,  LISTAGG(CASE WHEN F.CODTIPOPER = 1802 THEN F.NUMNFSE ELSE TO_CHAR(F.NUMNOTA) END,' / ') WITHIN GROUP (ORDER BY CASE WHEN F.CODTIPOPER = 1802 THEN F.NUMNFSE ELSE TO_CHAR(F.NUMNOTA) END) AS NOTAS,
     to_char(sum(F.VLRDESDOB), '99G999G999D09')  AS VALOR, F.DTVENC
    FROM TGFFIN F, TGFPAR P
    WHERE F.DTVENC+15 = TRUNC(SYSDATE)
  AND F.CODPARC = P.CODPARC
  AND F.RECDESP = 1
  AND F.PROVISAO = 'N'
  AND F.DHBAIXA IS NULL
  GROUP BY P.RAZAOSOCIAL,  F.DTVENC;

  p_mensagem         CLOB;
  p_msgloop          CLOB;


BEGIN


FOR R1 IN C1

LOOP
  p_msgloop :=  p_msgloop||  '<tr><td>'||R1.RAZAOSOCIAL||'</td>
                                  <td>'||TO_CHAR(R1.DTVENC,'DD/MM/YYYY')||'</td>
                                  <td  style="text-align: left;">'||R1.NOTAS||'</td>
                                  <td  style="text-align: right">'||R1.VALOR||'</td></tr>';
END LOOP;
p_mensagem    := '<!DOCTYPE html>
                                            <html lang="pt-br">
                                            <head>
                                              <style>
                                                table, th, td {
                                                    border: 1px solid black;
                                                    border-collapse: collapse;
                                                    text-align: center;
                                                    font-size: 10px;
                                                    padding-left: 2px;
                                                    padding-right: 2px;
                                                }
                                               </style>
                                              <title>Clientes em aberto a 15 dias ou mais</title>
                                            </head>
                                            <body>
                                               <h3>Clientes em aberto a 15 dias ou mais</h3>
                                                <table>
                                                    <tr>
                                                        <th>Raz達o Social</th>
                                                        <th>Em aberto desde</th>
                                                        <th>Notas Emitidas</th>
                                                        <th>Debito Total</th>
                                                    </tr>'
                                                    ||p_msgloop||
                                                    '
                                                </table>
                                            </body>
                                          </html>';

send_mail(p_to        => 'cobranca@century.net.br',
           p_from      => 'erp@centurytelecom.com.br',
           p_cc        => 'philipe@century.net.br',
           p_subject   => 'Clientes em aberto a 15 dias ou mais',
           p_text_msg  => '',
           p_html_msg  =>  p_mensagem,
           p_smtp_host => 'maladireta.task.com.br');

END;',next_date=>'01/01/4000 00:00',interval=>'TRUNC(SYSDATE+1)',no_parse=>TRUE);
exec dbms_job.isubmit(job=>262,what=>'DECLARE
 CURSOR C1 IS
 SELECT P.RAZAOSOCIAL,  LISTAGG(CASE WHEN F.CODTIPOPER = 1802 THEN F.NUMNFSE ELSE TO_CHAR(F.NUMNOTA) END,' / ') WITHIN GROUP (ORDER BY CASE WHEN F.CODTIPOPER = 1802 THEN F.NUMNFSE ELSE TO_CHAR(F.NUMNOTA) END) AS NOTAS,
     to_char(sum(F.VLRDESDOB), '99G999G999D09')  AS VALOR, F.DTVENC
    FROM TGFFIN F, TGFPAR P
    WHERE F.DTVENC+30 = TRUNC(SYSDATE)
  AND F.CODPARC = P.CODPARC
  AND F.RECDESP = 1
  AND F.PROVISAO = 'N'
  AND F.DHBAIXA IS NULL
  GROUP BY P.RAZAOSOCIAL,  F.DTVENC;

  p_mensagem         CLOB;
  p_msgloop          CLOB;


BEGIN


FOR R1 IN C1

LOOP
  p_msgloop :=  p_msgloop||  '<tr><td>'||R1.RAZAOSOCIAL||'</td>
                                  <td>'||TO_CHAR(R1.DTVENC,'DD/MM/YYYY')||'</td>
                                  <td  style="text-align: left;">'||R1.NOTAS||'</td>
                                  <td  style="text-align: right">'||R1.VALOR||'</td></tr>';
END LOOP;
p_mensagem    := '<!DOCTYPE html>
                                            <html lang="pt-br">
                                            <head>
                                              <style>
                                                table, th, td {
                                                    border: 1px solid black;
                                                    border-collapse: collapse;
                                                    text-align: center;
                                                    font-size: 10px;
                                                    padding-left: 2px;
                                                    padding-right: 2px;
                                                }
                                               </style>
                                              <title>Clientes em aberto a 30 dias ou mais</title>
                                            </head>
                                            <body>
                                               <h3>Clientes em aberto a 30 dias ou mais</h3>
                                                <table>
                                                    <tr>
                                                        <th>Raz達o Social</th>
                                                        <th>Em aberto desde</th>
                                                        <th>Notas Emitidas</th>
                                                        <th>Debito Total</th>
                                                    </tr>'
                                                    ||p_msgloop||
                                                    '
                                                </table>
                                            </body>
                                          </html>';

send_mail(p_to        => 'andre.goncalves@century.net.br',
           p_from      => 'erp@centurytelecom.com.br',
           p_cc        => 'philipe@century.net.br',
           p_subject   => 'Clientes em aberto a 30 dias ou mais',
           p_text_msg  => '',
           p_html_msg  =>  p_mensagem,
           p_smtp_host => 'maladireta.task.com.br');

END;',next_date=>'01/01/4000 00:00',interval=>'TRUNC(SYSDATE+1)',no_parse=>TRUE);
exec dbms_job.isubmit(job=>383,what=>'SANKHYA.CHECK_FECHAMENTO_PEND_CTRY;',next_date=>'01/01/4000 00:00',interval=>'TRUNC(SYSDATE+1)+6/24',no_parse=>TRUE);

execute this script again:

SELECT  DBMS_METADATA.get_ddl ('PROCOBJ', job_name, owner)
FROM   dba_scheduler_jobs
where owner IN ('SYS','C##CLOUD$SERVICE','ORDS_METADATA','APEX_200200')

+------------------------------------------------------------------------------+
| From this point are examples:       Error - ORA-31603   - EXAMPLES           |
+------------------------------------------------------------------------------+


But what if the job owner is SYS? Will the same syntax work?

SQL> select dbms_metadata.get_ddl('PROCOBJ','CLEANUP_ONLINE_IND_BUILD','SYS') from dual
ERROR:
ORA-31603: object "CLEANUP_ONLINE_IND_BUILD" of type PROCOBJ not found in schema "SYS"
ORA-06512: at "SYS.DBMS_METADATA", line 6069
ORA-06512: at "SYS.DBMS_METADATA", line 8666
ORA-06512: at line 1

SQL> select owner,job_name from dba_scheduler_jobs where job_name='CLEANUP_ONLINE_IND_BUILD'

OWNER JOB_NAME
------------ --------------------------------- PRO SYS CLEANUP_ONLINE_IND_BUILD

SQL> exec dbms_scheduler.copy_job('SYS.CLEANUP_ONLINE_IND_BUILD','DBACLASS.CLEANUP_ONLINE_IND_BUILD')

PL/SQL procedure successfully completed.


SQL> select owner,job_name from dba_scheduler_jobs where job_name='CLEANUP_ONLINE_IND_BUILD'

OWNER JOB_NAME
------------ --------------------------------- PRO SYS CLEANUP_ONLINE_IND_BUILD
DBACLASS CLEANUP_ONLINE_IND_BUILD -- >> another copy of that job

SQL> select dbms_metadata.get_ddl('PROCOBJ','CLEANUP_ONLINE_IND_BUILD','BSSDBA') from dual

DBMS_METADATA.GET_DDL('PROCOBJ','CLEANUP_ONLINE_IND_BUILD','BSSDBA')
------------------------------------------------------------------------------- PRO

BEGIN
dbms_scheduler.create_job('"CLEANUP_ONLINE_IND_BUILD"',
job_type=>'PLSQL_BLOCK', job_action=>
'declare
myinterval number
begin
myinterval := dbms_pdb.cleanup_task(2)
if myinterval <> 0 then
next_date := systimestamp +
numtodsinterval(myinterval, ''second'')
end if
end;'
, number_of_arguments=>0,
start_date=>TO_TIMESTAMP_TZ('07-JUL-2014 05.53.58.299360000 AM -07:00','DD-MON-R
RRR HH.MI.SSXFF AM TZR','NLS_DATE_LANGUAGE=english'), repeat_interval=>
'FREQ = HOURLY; INTERVAL = 1'
, end_date=>NULL,
job_class=>'"SCHED$_LOG_ON_ERRORS_CLASS"', enabled=>FALSE, auto_drop=>TRUE,comme
nts=>
'Cleanup Online Index Build'
)
COMMIT
END


</PRE>
<font class="f">rock script (c) 2021. Version v1.0 (2021-03-01). Timestamp: 13/04/2021 12:18 </font>

