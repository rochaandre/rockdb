<!- PRO --------------------------------------------------------------------------------------- PRO - PRO -- File name:   /Users/andre/Dropbox/scriptsGRAPHICO/report/output/presamp11bdsrv03promedcorp/job_ddl_presamp11.html
- PRO -- Purpose:     Jobs scripts
- PRO -- Warning:
- PRO -- Author:      Andre Rocha
- PRO -- Version:     13/04/2021 10:50
- PRO -- Usage:
- PRO -- Example:
- PRO -- Notes:       Developed and tested on 11.2.0.3
- PRO -------------------------------------------------------------------------------------- PRO -- @report/sql/headerdoc.sql name.html "Created to output list of html report" "Pay attention to variables" "Usage" "example usage"
-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<!-- $Header:  $ -->
<!-- rock_copyright (c) 2021, All rights reserved. -->
<!-- Author: techmaxconsultoria@gmail.com -->
<head>
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
<link rel="icon" href="icon/server.svg" type="image/x-icon" />
<title>Jobs scripts</title>
<style type="text/css">
body             {font:10pt Arial,Helvetica,Geneva,sans-serif; color:black; background:white;}
h1               {font-size:16pt; font-weight:bold; color:#336699; border-bottom:5px solid #336699; margin-top:0pt; margin-bottom:0pt; padding:0px 0px 0px 0px;}
h2               {font-size:14pt; font-weight:bold; color:#336699; margin-top:4pt; margin-bottom:0pt;}
h3               {font-size:12pt; font-weight:bold; color:#336699; margin-top:4pt; margin-bottom:0pt;}
pre              {font:8pt monospace,Monaco,"Courier New",Courier;}
a                {color:#663300;}
table            {font-size:8pt; border-collapse:collapse; empty-cells:show; white-space:nowrap; border:1px solid #336699;}
li               {font-size:8pt; color:black; padding-left:4px; padding-right:4px; padding-bottom:2px;}
th               {font-weight:bold; color:red; background:#0066CC; padding-left:4px; padding-right:4px; padding-bottom:2px;}
tr               {color:black; background:white;}
tr:hover         {color:white; background:#0066CC;}
tr.main          {color:black; background:white;}
tr.main:hover    {color:black; background:white;}
td               {vertical-align:top; border:1px solid #336699;}
td.c             {text-align:center;}
font.n           {font-size:8pt; font-style:italic; color:#336699;}
font.f           {font-size:8pt; color:#999999; border-top:1px solid #336699; margin-top:30pt;}
div.google-chart {width:809px; height:500px;}
</style>
</head>

<h1> <a href="index_presamp11.html" target="_blank"><img src="icon/server.svg" alt="index_presamp11.html" height="33" width="52" /></a> presamp11.html <em>(Jobs scripts)</em>  </h1>
<PRE>

+------------------------------------------------------------------------------+
|            Jobs for this database DBA_SCHEDULER_JOBS   non SYS               |
+------------------------------------------------------------------------------+

exec dbms_job.isubmit(job=>1,what=>'dbms_refresh.refresh('"BDSAMP"."TMP_TOTAL_VENDIDOPAGA"');',next_date=>'14/04/2021 00:00',interval=>'trunc(sysdate)+1 ',no_parse=>TRUE);

+------------------------------------------------------------------------------+
|            Jobs for this database DBA_SCHEDULER_JOBS  in SYS                 |
+------------------------------------------------------------------------------+

for Jobs in SYS we need create a user and copy the job to the new schema.

exec dbms_scheduler.copy_job('sys.kill_hung_session','oracle.kill_hung_session_copy')
exec dbms_job.isubmit(job=>1,what=>'dbms_refresh.refresh('"BDSAMP"."TMP_TOTAL_VENDIDOPAGA"');',next_date=>'14/04/2021 00:00',interval=>'trunc(sysdate)+1 ',no_parse=>TRUE);

execute this script again:

SELECT  DBMS_METADATA.get_ddl ('PROCOBJ', job_name, owner)
FROM   dba_scheduler_jobs
where owner IN ('SYS','C##CLOUD$SERVICE','ORDS_METADATA','APEX_200200')

+------------------------------------------------------------------------------+
| From this point are examples:       Error - ORA-31603   - EXAMPLES           |
+------------------------------------------------------------------------------+


But what if the job owner is SYS? Will the same syntax work?

SQL> select dbms_metadata.get_ddl('PROCOBJ','CLEANUP_ONLINE_IND_BUILD','SYS') from dual
ERROR:
ORA-31603: object "CLEANUP_ONLINE_IND_BUILD" of type PROCOBJ not found in schema "SYS"
ORA-06512: at "SYS.DBMS_METADATA", line 6069
ORA-06512: at "SYS.DBMS_METADATA", line 8666
ORA-06512: at line 1

SQL> select owner,job_name from dba_scheduler_jobs where job_name='CLEANUP_ONLINE_IND_BUILD'

OWNER JOB_NAME
------------ --------------------------------- PRO SYS CLEANUP_ONLINE_IND_BUILD

SQL> exec dbms_scheduler.copy_job('SYS.CLEANUP_ONLINE_IND_BUILD','DBACLASS.CLEANUP_ONLINE_IND_BUILD')

PL/SQL procedure successfully completed.


SQL> select owner,job_name from dba_scheduler_jobs where job_name='CLEANUP_ONLINE_IND_BUILD'

OWNER JOB_NAME
------------ --------------------------------- PRO SYS CLEANUP_ONLINE_IND_BUILD
DBACLASS CLEANUP_ONLINE_IND_BUILD -- >> another copy of that job

SQL> select dbms_metadata.get_ddl('PROCOBJ','CLEANUP_ONLINE_IND_BUILD','BSSDBA') from dual

DBMS_METADATA.GET_DDL('PROCOBJ','CLEANUP_ONLINE_IND_BUILD','BSSDBA')
------------------------------------------------------------------------------- PRO

BEGIN
dbms_scheduler.create_job('"CLEANUP_ONLINE_IND_BUILD"',
job_type=>'PLSQL_BLOCK', job_action=>
'declare
myinterval number
begin
myinterval := dbms_pdb.cleanup_task(2)
if myinterval <> 0 then
next_date := systimestamp +
numtodsinterval(myinterval, ''second'')
end if
end;'
, number_of_arguments=>0,
start_date=>TO_TIMESTAMP_TZ('07-JUL-2014 05.53.58.299360000 AM -07:00','DD-MON-R
RRR HH.MI.SSXFF AM TZR','NLS_DATE_LANGUAGE=english'), repeat_interval=>
'FREQ = HOURLY; INTERVAL = 1'
, end_date=>NULL,
job_class=>'"SCHED$_LOG_ON_ERRORS_CLASS"', enabled=>FALSE, auto_drop=>TRUE,comme
nts=>
'Cleanup Online Index Build'
)
COMMIT
END


</PRE>
<font class="f">rock script (c) 2021. Version v1.0 (2021-03-01). Timestamp: 13/04/2021 10:50 </font>

